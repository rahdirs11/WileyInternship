USE mthree_june;

CREATE TABLE TRANSACTIONS1(
	INVOICENO VARCHAR(3),
    INVOICEDATE DATE,
    SKUCODE INT(4),
    QUANTITY INT(30),
    GROSSVALUE INT(20),
    NETVALUE INT(20));


INSERT INTO TRANSACTIONS1 VALUES('S01','2020-12-17',1001,2,2000,1200);
INSERT INTO TRANSACTIONS1 
	VALUES('S01','2021-12-02',1001,2,2000,1200),
    ('S02','2018-12-17',1002,3,5000,4000),
    ('S03','2017-12-19',1003,1,10000,50000),
    ('S04','2020-03-02',1001,2,20000,1200),
    ('S05','2020-07-02',1001,2,20000,1200);



SELECT * FROM TRANSACTIONS1;

#1. QUERY TO GET YEARWISE GROSS VALUES
SELECT CASE 
	WHEN `Invoicedate` BETWEEN '2017-04-01' AND '2018-03-31' THEN 'FY2017'
	WHEN `Invoicedate` BETWEEN '2020-04-01' AND '2021-03-31' THEN 'FY2020'
	WHEN `Invoicedate` BETWEEN '2018-04-01' AND '2019-03-31' THEN 'FY2018'
	WHEN `Invoicedate` BETWEEN '2021-04-01' AND '2022-03-31' THEN 'FY2021'
    WHEN `Invoicedate` BETWEEN '2019-04-01' AND '2020-03-31' THEN 'FY2019'
        END AS `Financial Year`,SUM(`GROSSVALUE`) AS 'GROSS VALUE' FROM TRANSACTIONS1
        GROUP BY 1;        
        
        
    #2 QUERY TO CALCULATE QUARTERLY     
	SELECT  CASE 
	WHEN `Invoicedate` BETWEEN '2017-04-01' AND '2018-03-31' THEN 'FY2017'
	WHEN `Invoicedate` BETWEEN '2020-04-01' AND '2021-03-31' THEN 'FY2020'
	WHEN `Invoicedate` BETWEEN '2018-04-01' AND '2019-03-31' THEN 'FY2018'
    WHEN `Invoicedate` BETWEEN '2021-04-01' AND '2022-03-31' THEN 'FY2021'
    WHEN `Invoicedate` BETWEEN '2019-04-01' AND '2020-03-31' THEN 'FY2019'
        END AS `Financial Year`, 
	CASE 
	WHEN MONTH(`Invoicedate`) BETWEEN 04 AND 07 THEN 'Q1'
	WHEN MONTH(`Invoicedate`) BETWEEN 05 AND 08 THEN 'Q2'
	WHEN MONTH(`Invoicedate`) BETWEEN 09 AND 12 THEN 'Q3'
    WHEN MONTH(`Invoicedate`) BETWEEN 01 AND 04 THEN 'Q4'
        END AS `QUARTER`,
        `GrossValue`-`NETVALUE` AS `MARGIN`
	FROM TRANSACTIONS1
        GROUP BY 
		CASE 
			WHEN `Invoicedate` BETWEEN '2017-04-01' AND '2018-03-31' THEN 'FY2017'
			WHEN `Invoicedate` BETWEEN '2020-04-01' AND '2021-03-31' THEN 'FY2020'
			WHEN `Invoicedate` BETWEEN '2018-04-01' AND '2019-03-31' THEN 'FY2018'
            WHEN `Invoicedate` BETWEEN '2021-04-01' AND '2022-03-31' THEN 'FY2021'
            WHEN `Invoicedate` BETWEEN '2019-04-01' AND '2020-03-31' THEN 'FY2019'
		END,CASE
        WHEN MONTH(`Invoicedate`) BETWEEN 04 AND 07 THEN 'Q1'
		WHEN MONTH(`Invoicedate`) BETWEEN 05 AND 08 THEN 'Q2'
		WHEN MONTH(`Invoicedate`) BETWEEN 09 AND 12 THEN 'Q3'
		WHEN MONTH(`Invoicedate`) BETWEEN 01 AND 04 THEN 'Q4'
        END;
        
        
SELECT SUM(`GROSSVALUE`) FROM TRANSACTIONS1;

